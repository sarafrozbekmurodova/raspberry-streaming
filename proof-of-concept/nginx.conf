# sources:
#   https://nginx.org/en/docs/http/ngx_http_hls_module.html
#   https://github.com/SoloSynth1/nginx-hls-server
#   https://hlsbook.net/hls-nginx-rtmp-module/
server {
    listen 80;
    server_name streamer;

    # Serve files from /var/www/pi_streamer/media
    root /var/www/pi_streamer/media;
    index index.html;

    # Serve HLS segments under /hls/
    location /hls/ {
        alias /var/www/pi_streamer/media/hls/;
        add_header 'Access-Control-Allow-Origin' '*' always;
        add_header 'Access-Control-Allow-Methods' 'GET, OPTIONS' always;
        add_header 'Access-Control-Allow-Headers' 'Range,Accept,Origin' always;
        add_header 'Access-Control-Expose-Headers' 'Content-Length,Content-Range' always;

        # quick CORS preflight handling
        if ($request_method = 'OPTIONS') {
            return 204;
        }
    }

    # ensure correct MIME types
    types {
        application/vnd.apple.mpegurl m3u8;
        video/mp2t ts;
        text/html html;
        image/x-icon ico;
        image/vnd.microsoft.icon cur;
    }

    access_log /var/log/nginx/pi_streamer.access.log;
    error_log  /var/log/nginx/pi_streamer.error.log;
}
